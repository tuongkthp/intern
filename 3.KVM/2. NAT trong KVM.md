# Chế độ mạng NAT trong KVM
- Mô hình:

![Nat](image/Nat-1.png)

- Nat trong KVM:
    + KVM sẽ tạo một virtual router (bộ định tuyến ảo)

    + Khi bạn tạo một dải mạng NAT cho VM, trên host KVM sẽ xuất hiện một card mạng ảo đóng vai trò gateway cho dải mạng đó

    + VM khi sử dụng mạng NAT → khi ra internet, VM được NAT (địa chỉ IP nội bộ) sang địa chỉ của host — nghĩa là host “đại diện” cho VM khi giao tiếp ra ngoài.

    + VM có thể truy cập internet / mạng bên ngoài, nhưng các máy từ bên ngoài mạng không thể tự động nhìn thấy (không truy cập được) VM

    + NAT được thực hiện qua iptables:

- Các rule trong iptables sử dụng cho NAT:
    + SNAT: Đổi địa chỉ IP nguồn sang một IP cố định

    + MASQUERADE: Giống SNAT nhưng dùng cho IP động (PPP, DHCP)

    + DNAT: Đổi địa chỉ IP đích sang IP khác

    + REDIRECT: Chuyển hướng gói tin về chính máy (thường dùng cho proxy, port forwarding nội bộ)