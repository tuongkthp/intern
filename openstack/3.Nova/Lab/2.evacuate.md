# Evacuate vm 
Trong OpenStack, khi thực hiện thao tác evacuate instance, dịch vụ Nova không chỉ khởi tạo lại máy ảo trên compute khác mà còn phải làm việc trực tiếp với Neutron để cấu hình lại kết nối mạng cho instance.

Nova cần cập nhật thông tin binding của port Neutron để:

- Gán lại port sang compute host mới

- Cập nhật binding:profile phục vụ quá trình migrate / evacuate

- Đảm bảo interface của VM được plug đúng backend (OVS, Linux Bridge, SR-IOV…)

Cần cấu hình policy cho phép user nova thực hiện:
```sh
#file policy.yaml
update_port: role:admin or role:service
update_port:binding:profile: role:admin or role:service
```

Thực hiện evacuate
```sh
openstack server evacuate --host [target-host] --password [password] <server>
```

Note:
- Nếu vm dùng volume, cần detach volume trước khi evacuate hoặc thêm [--force] vào câu lệnh evacuate

- vm có disk là loại local disk và ko shared cho các host khác thì evacuate chỉ build lại vm, còn dữ liệu sẽ mất

























