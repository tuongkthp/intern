# 1. Openstack API
- Sử dụng OpenStack API cho phép người dùng tạo server, image, gán metadata cho instance, tạo storage container, object, v.v. Nói chung sẽ cho phép người dùng thao tác với OpenStack cloud

Để Thao Tác Với API OpenStack, Các Phương Thực Cơ Bản

- curl:
    + Công cụ dòng lệnh cho phép tương tác với các giao thức FTP, FTPS, HTTP, HTTPS, IMAP, SMTP, v.v

    + Không có giao diện, chạy trên dòng lệnh, nhanh gọn

- Openstack command-line client:
    + Mỗi Project trong OpenStack cho phép người dùng tương tác với chính nó thông qua cli. Bản chất các CLI sử dụng API OPS

# 2. Dùng curl
### 2.1. Lấy token
- Câu lệnh
```sh
curl -i -H "Content-Type: application/json" -d '
{ "auth": {
    "identity": {
        "methods": ["password"],
        "password": {
            "user": {
              "name": "admin",
              "domain": { "name": "Default" },
              "password": "Tuong123"
            }
          }
        },
        "scope": {
          "project": {
            "name": "admin",
            "domain": { "name": "Default" }
          }
        }
      }
}' http://14.225.1.147:5000/v3/auth/tokens
```
- Kết quả
```sh
HTTP/1.1 201 CREATED
Date: Thu, 11 Dec 2025 09:35:05 GMT
Server: Apache/2.4.58 (Ubuntu)
Content-Length: 3575
X-Subject-Token: gAAAAABpOpBJXT4F7UHp8CzxhYOR7WD0IzS55GuL1xqdwmTNi_Ki3bRYSuIHzP0hMt541lSc_XNsTHWX6GxQN1TbygN_1h-KyWeSNoMf65uYhkLSjrF0RqTeJonH6FNVeIiRwkwIC0xhUOcvSY9ZtmDYo9dJ67f2uFlMQqOClXhy_QphRH3Vn1Q
Vary: X-Auth-Token
x-openstack-request-id: req-10870c0a-f58b-4e41-a5d1-3d4f059df500
Content-Type: application/json

{"token": {"methods": ["password"], "user": {"domain": {"id": "default", "name": "Default"}, "id": "5d51c922d3e842689c71da5c6a766f2a", "name": "admin", "password_expires_at": null}, "audit_ids": ["GmKxXHsGRyu7l5poMvIHrA"], "expires_at": "2025-12-11T10:35:05.000000Z", "issued_at": "2025-12-11T09:35:05.000000Z", "project": {"domain": {"id": "default", "name": "Default"},...
``` 

- Token nằm ở phía sau X-Subject-Token. Set nó vào biến môi trường để không phải khai báo ở những thao tác tiếp theo:

```sh
OS_TOKEN=gAAAAABpOpBJXT4F7UHp8CzxhYOR7WD0IzS55GuL1xqdwmTNi_Ki3bRYSuIHzP0hMt541lSc_XNsTHWX6GxQN1TbygN_1h-KyWeSNoMf65uYhkLSjrF0RqTeJonH6FNVeIiRwkwIC0xhUOcvSY9ZtmDYo9dJ67f2uFlMQqOClXhy_QphRH3Vn1Q
```

### 2.2. Liệt kê user
- Câu lệnh 
```sh
curl -s -H "X-Auth-Token: $OS_TOKEN" \
http://controller:5000/v3/users | python3 -mjson.tool
```

- Kết quả
```sh
{
    "users": [
        {
            "id": "317c7b8f58e941de8bc1ebe38d0bf764",
            "name": "glance",
            "domain_id": "default",
            "enabled": true,
            "password_expires_at": null,
            "options": {},
            "links": {
                "self": "http://localhost:5000/v3/users/317c7b8f58e941de8bc1ebe38d0bf764"
            }
        },
        {
            "id": "417efe8c7adc446a889111f13593bb37",
            "name": "placement",
            "domain_id": "default",
            "enabled": true,
            "password_expires_at": null,
            "options": {},
            "links": {
                "self": "http://localhost:5000/v3/users/417efe8c7adc446a889111f13593bb37"
            }
        },...
```

### 2.3. Liệt kê groups
- Câu lệnh 
```sh
curl -s -H "X-Auth-Token: $OS_TOKEN" \
http://controller:5000/v3/groups | python3 -mjson.tool
```

- Kết quả
```sh
{
    "groups": [],
    "links": {
        "next": null,
        "self": "http://localhost:5000/v3/groups",
        "previous": null
    }
}
```

### 2.4. Tạo domain
- Câu lệnh 
```sh
curl -s -H "X-Auth-Token: $OS_TOKEN" -H "Content-Type: application/json" -d '{ "domain": { "name": "test1"}}' http://controller:5000/v3/domains | python3 -mjson.tool
```

- Kết quả
```sh
{
    "domain": {
        "id": "77ee810d87044898bb0da6a0c0dd8da4",
        "name": "test1",
        "description": "",
        "enabled": true,
        "tags": [],
        "options": {},
        "links": {
            "self": "http://controller:5000/v3/domains/77ee810d87044898bb0da6a0c0dd8da4"
        }
    }
}
```

### 2.5. Tạo user
- Câu lệnh
```sh
curl -s -H "X-Auth-Token: $OS_TOKEN" -H "Content-Type: application/json" -d '{ "user": { "name": "tuongne", "password": "Tuong123", "email": "tuongne@gmail.com", "domain_id": "77ee810d87044898bb0da6a0c0dd8da4", "description": "user duoc tao bang lenh curl"}}' http://controller:5000/v3/users | python3 -mjson.tool
```

- Kết quả
```sh
{
    "user": {
        "email": "tuongne@gmail.com",
        "description": "user duoc tao bang lenh curl",
        "id": "31aa1f53088941afb54a74bbd468435a",
        "name": "tuongne",
        "domain_id": "77ee810d87044898bb0da6a0c0dd8da4",
        "enabled": true,
        "password_expires_at": null,
        "options": {},
        "links": {
            "self": "http://controller:5000/v3/users/31aa1f53088941afb54a74bbd468435a"
        }
    }
}
```
