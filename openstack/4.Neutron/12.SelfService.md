# Mô tả:
Host controller:
```sh
eth0: 14.225.1.147/24 (Ping được ra ngoài mạng)
eth1: 10.20.1.198/24 (Ko ping được ra ngoài mạng)
```

Dải mạng seftservice: 192.10.2.0/24

Yêu cầu:
- Sử dụng eth1 làm provider network

- br-provider: bridge OVS gắn eth1

- selfservice: mạng private cho VM
→ 192.10.2.0/24

- Router1: nối selfservice ↔ provider

- Floating IP: 10.20.1.x

- Cấu hình iptables cho phép vm ping được ra ngoài mạng

# Thực hành
Tạo bridge provider và gắn NIC eth1
```sh
ovs-vsctl add-br br-provider
ovs-vsctl add-port br-provider eth1
ip link set br-provider up
```

Chuyển IP provider sang br-provider
```sh
ip address flush dev eth1
ip addr add 10.20.1.198/24 dev br-provider
```

Sửa file /etc/neutron/plugins/ml2/openvswitch_agent.ini
```sh
[ovs]
bridge_mappings = provider:br-provider
```

Restart dịch vụ
```sh
systemctl restart openvswitch-switch
systemctl restart neutron-openvswitch-agent
```

Tạo Provider network
```sh
openstack network create provider
```

Tạo provider subnet
```sh
openstack subnet create provider-subnet \
  --network provider \
  --subnet-range 10.20.1.0/24 \
  --allocation-pool start=10.20.1.50,end=10.20.1.190 \
  --no-dhcp
  --gateway 10.20.1.198
```

Tạo Self-service network + subnet
```sh
openstack network create selfservice

openstack subnet create selfservice-subnet \
  --network selfservice \
  --subnet-range 192.10.2.0/24 \
  --gateway 192.10.2.1 \
  --dns-nameserver 8.8.8.8
```

Tạo router neutron
```sh
openstack router create Router1
openstack router set --external-gateway provider Router1
openstack router add subnet Router1 selfservice-subnet
```

Sửa rule của Security Group
```sh
openstack security group rule create --protocol icmp default
openstack security group rule create --protocol tcp --dst-port 22 default
```

Floating IP & SSH
```sh
openstack floating ip create provider
openstack server add floating ip vm11 10.20.1.xx
```

Khi này, tạo vm với subnet của selfservice network sẽ ping được ra ngoài mạng








