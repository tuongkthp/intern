# 1. Security Group trong Openstack
## 1.1 Overview

- Security group là bộ các quy tắc để filter các IP, nó được áp dụng cho tất cả các instance để định nghĩa mạng truy cập và các máy ảo. Group rules được xác định cho các projects cụ thể, các user thuộc vào project nào thì có thể chỉnh sửa, thêm, xóa các rule của group tương ứng.

- Tất cả các project đều có một security-groups mặc định là default được áp dụng cho bất kỳ một instance nào không được định nghĩa một security group nào khác. Nếu không thay đổi gì thì mặc định security group sẽ chặn tất cả các incoming traffic với instance của bạn.

- Bạn có thể sử dụng option `allow_same_net_traffic` trong `file /etc/nova/nova.conf` để kiểm soát toàn bộ nếu các rules áp dụng cho host được chia sẻ mạng. Có hai giá trị có thể:

    + True (default)
        * Hosts cũng nằm trên một subnet không được lọc và được cho phép đi qua đối với tất cả các loại traffic giữa chúng. Trên Flat network, tất cả các instances của tất cả các project đề không được lọc khi giao tiếp với nhau. Với VLAN, cho phép truy cập giữa các instance cùng project. Bạn cũng có thể mô phỏng option này bằng cách cấu hình default security group cho phép tất cả các traffic từ subnet.

    + False
        * Security groups sẽ bắt buộc được áp dụng cho tất cả các kết nối, kể cả các kết nối cùng mạng.

- Ngoài ra, số lượng tối đa các rules trong một security group được điểu khiển bởi `security_group_rules` và số lượng các `security groups` cho một project được điểu khiển bởi `security_groups`

## 1.2 List and view current security groups
Có thể sử dụng command-line để lấy danh sách các security groups cho một project cụ thể bằng cách sử dụng openstack hoặc nova command:

1. Đảm bảo các giá trị xác thực về user và project có security groups muốn xem

```sh
export OS_USERNAME=myuser
export OS_TENANT_NAME=thanhbc
```

2. Sử dụng openstack command để xem danh sách các security group hiện có trong project:

```sh
 openstack security group list
```

3. Xem chi tiết một security group:

```sh
openstack security group rule list GROUPNAME
```

## 1.3 Create a security group
- Khi thêm một security group mới, nên pick thêm một mô tả ngắn gọn.

- Add thêm một security group mới:

```sh
openstack security group create GroupName --description Description
```

- Add một rule mới vào group:

```sh
openstack security group rule create SEC_GROUP_NAME --protocol PROTOCOL --dst-port FROM_PORT:TO_PORT --remote-ip CIDR
```

- Xem các rule có trong một security group:

```sh
openstack security group rule list <ID-sec-group>
```

- Để xem tất cả các rule trong các group ở tất cả các project:

```sh
neutron security-group-rule-list
```

## 1.4. Delete a security group
- Để xóa một new security group, thực hiện lệnh sau:

```sh
openstack security group delete GROUPNAME
```

## 1.5. Create security group rules for a cluster of instances
- Source Groups là một loại đặc biệt, linh động để xác định CIDR của các sources được cho phép. User cụ thể cho một Source Group (Security Group name) và tất cả các instance của user khác sử dụng một Source Group được lữa chọn linh động. Điều này làm giảm nhu cầu về các quy tắc riêng cho phép cho mỗi một user mới của cluster.

- Tạo source group:

```sh
openstack security group rule create secGroupName \
   --remote-group source-group --protocol ip-protocol \
    --dst-port from-port:to-port
```

# 2. Security port trong openstack.
- Port Security là cơ chế kiểm soát truy cập mạng ở cấp độ cổng mạng ảo (virtual port), chủ yếu dùng để bảo vệ các máy ảo (VM) khỏi các cuộc tấn công giả mạo (spoofing) bằng cách áp dụng các quy tắc chống giả mạo (anti-spoofing) để đảm bảo VM chỉ gửi/nhận traffic với địa chỉ MAC/IP được gán cho cổng của nó

- Nó bao gồm việc sử dụng Security Groups để chặn/cho phép traffic và các quy tắc chống giả mạo tích hợp trong Neutron, ngăn chặn VM sử dụng sai MAC hoặc IP, nhưng có thể cần tùy chỉnh cho các trường hợp đặc biệt như NFV

- Các thành phần chính của Port Security:
    + Security Groups (Nhóm Bảo mật): Tường lửa ảo cho cổng, kiểm soát traffic vào (ingress) và ra (egress) cho các VM. Mặc định, mọi traffic đều bị chặn trừ khi được cho phép bởi một Security Group.

    + Anti-Spoofing Rules: Các quy tắc tích hợp trong Neutron, ngăn VM sử dụng địa chỉ MAC hoặc IP không thuộc về nó. Điều này ngăn chặn các cuộc tấn công như ARP spoofing. 















