# Keystone - Openstack Identity Service
# 1. Giới thiệu
- Môi trường cloud theo mô hình *Infrastructure-as-a-Service (IaaS) cung cấp cho người dùng nguồn tài nguyên chính như máy ảo, lượng lớn block và object storage, và băng thông mạng.

- Một tính năng quan trọng của môi trường cloud là nó cung cấp tài nguyên một cách bảo mật, truy cập điều khiển an toàn vào các tài nguyên có giá trị. Trong Openstack (OPS) Keystone là dịch vụ có khả năng cung cấp sự truy cập an toàn tới tất cả các tài nguyên cloud. Keystone đã chứng minh được sự cần thiết của nó trong môi trường cloud bảo mật.

- Keystone là một Openstack service, nó cung cấp các API client authentication, tìm kiếm và phân bố nhiều các tenant bằng OpenStack’s Identity API.

- Nhiệm vụ của Keystone: Cung cấp dịch vụ xác thực cho toàn bộ hạ tầng OpenStack
    + Theo dõi người dùng và quyền hạn của họ

    + Cung cấp một catalog của các dịch vụ đang sẵn sàng với các API endpoints để truy cập các dịch vụ đó

# 2. Chức năng chính của Keystone
Trong môi trường Openstack, điểm quan trọng trong bảo mật cloud chính là Keystone – dịch vụ định danh Identity của Openstack. Keystone cung cấp rất nhiều chức năng:

- Identity – Định danh:
    + Đề cập tới việc định danh cho người dùng đang truy cập vào tài nguyên của Openstack, định danh đơn giản được hiểu là đại diện cho một user

    + Trong mô hình triển khai đơn giản, định danh cho user có thể được lưu trong database của Keystone

    + Trong mô hình doanh nghiệp, lớn, cần đến một nhà cung cấp định danh thường được sử dụng

- Authentication – Xác thực:
    + Là quá trình xử lý sự hợp lệ của định danh user

    + Trong nhiều trường hợp, sự xác thực là việc thực hiện đầu tiên cho user bằng cách login vào hệ thống với user identity và mật khấu

    + Trong môi trường OPS thô sơ, Keystone có khả năng tự tạo ra các bước xác thực bởi chính nó

- Access Management (Authorization):
    + Một user identity đã được xác thực và được tạo, cấp phát token, mọi thức bắt đầu thú vị. Đến đây đã có đủ nền tảng để bắt đầu Access management

    + Access Management cũng như là xác thực, là quá trình kiểm tra xem những tài nguyên nào user được phép truy cập. Môi trường cloud cung cấp cho user khả năng truy cập lượng lớn tài nguyên

# 3. Workflow của Keystone
!['workflow_keystone'](img/keystone-workflow.png)

- Cung cấp giao diện xác thực và quản lí truy cập cho các services của OpenStack. Nó cũng đồng thời lo toàn bộ việc giao tiếp và làm việc với các hệ thống xác thực bên ngoài.

- Cung cấp danh sách đăng kí các containers (“Projects”) mà nhờ vậy các services khác của OpenStack có thể dùng nó để "tách" tài nguyên (servers, images,...)

- Cung cấp danh sách đăng kí các Domains được dùng để định nghĩa các khu vực riêng biệt cho users, groups, và projects khiến các khách hàng trở nên "tách biệt" với nhau.

- Danh sách đăng kí các Roles được keystone dùng để ủy quyền cho các services của OpenStack thông qua file policy

- Assignment store cho phép users và groups được gán các roles trong projects và domains

# 4. Các thành phần và khái niệm trong Keystone
### 4.1. Users và Group (Actors)
- Trong keystone, Users và User Groups là những đối tượng được cấp phép truy cập tới các nguồn tài nguyên được cô lập trong domains và projects

- Groups là một tập hợp các users. Users và User Groups được gọi là Actors

### 4.2. Projects
- Trong Keystone, Project được dùng bởi các services của OpenStack để nhóm và cô lập các nguồn tài nguyên. Nó có thể được hiểu là 1 nhóm các tài nguyên mà chỉ có một số các user mới có thể truy cập và hoàn toàn tách biệt với các nhóm khác

- Ban đầu nó được gọi là tenants sau đó được đổi tên thành projects

- Mục đích cơ bản nhất của keystone chính là nơi để đăng kí cho các projects và xác định ai được phép truy cập projects

- Bản thân projects không sở hữu users hay groups mà users và groups được cấp quyền truy cập tới project sử dụng cơ chế gán role

### 4.3. Domains
- Trong thời kì đầu, không có bất cứ cơ chế nào để hạn chế sự truy cập của các project tới những nhóm user khác nhau. Điều này có thể gây ra những sự nhầm lẫn hay xung đột không đáng có giữa các tên của project của các tổ chức khác nhau

- Tên user cũng vậy và nó hoàn toàn cũng có thể dẫn tới sự nhầm lẫn nếu hai tổ chức có user có tên giống nhau

- Vì vậy mà khái niệm Domain ra đời, nó được dùng để cô lập danh sách các Projects và Users

- Domain được định nghĩa là một tập hợp các users, groups, và projects. Nó cho phép người dùng chia sẻ nguồn tài nguyên cho từng tổ chức sử dụng mà không phải lo xung đột hay nhầm lẫn

### 4.4. Roles
- Roles được dùng để hiện thực hóa việc cấp phép trong keystone. Một actor có thể có nhiều roles đối với từng project khác nhau

### 4.5. Targets
- Projects và Domains đều giống nhau ở chỗ cả hai đều là nơi mà role được "gán" lên. Vì thế chúng được gọi là targets

### 4.6. Assignment
- Role assignment là sự kết hợp của actor, target và role

- Role assignment được cấp phát, thu hồi, và có thể được kế thừa giữa các users, groups, project và domains

### 4.7. Catalog
- Chứa URLs và endpoints của các services khác nhau. Nếu không có Catalog, users và các ứng dụng sẽ không thể biết được nơi cần chuyển yêu cầu để tạo máy ảo hoặc lưu dữ liệu

- Service này được chia nhỏ thành danh sách các endpoints và mỗi một endpoint sẽ chứa admin URL, internal URL, and public URL




