# Host aggregates filter
Cấu hình cho file nova.conf cho phép filter Host aggregates
```sh
[filter_scheduler]
enabled_filters = AggregateInstanceExtraSpecsFilter
```

Restart dịch vụ 
```sh
systemctl restart nova-scheduler
```

Tạo một aggregate, thêm property ssd=true và add host hapu-lab-02 vào aggregate

```sh
root@hapu-lab-01:~# openstack aggregate create --zone nova fast-io                                                                                                                      
+-------------------+--------------------------------------+                                                                                                                            
| Field             | Value                                |                                                                                                                            
+-------------------+--------------------------------------+                                                                                                                            
| availability_zone | nova                                 |                                                                                                                            
| created_at        | 2026-01-14T03:22:00.031061           |                                                                                                                            
| deleted_at        | None                                 |                                                                                                                            
| hosts             | None                                 |                                                                                                                            
| id                | 1                                    |                                                                                                                            
| is_deleted        | False                                |                                                                                                                            
| name              | fast-io                              |                                                                                                                            
| properties        | None                                 |                                                                                                                            
| updated_at        | None                                 |                                                                                                                            
| uuid              | a4e4b998-7dc0-42a7-af0e-d6abf45c6b61 |                                                                                                                            
+-------------------+--------------------------------------+                                                                                                                            
root@hapu-lab-01:~# openstack aggregate set --property ssd=true 1                                                                                                                       
root@hapu-lab-01:~# openstack aggregate create --zone nova fast-io1                                                                                                                     
+-------------------+--------------------------------------+                                                                                                                            
| Field             | Value                                |                                                                                                                            
+-------------------+--------------------------------------+                                                                                                                            
| availability_zone | nova                                 |                                                                                                                            
| created_at        | 2026-01-14T03:22:29.414470           |                                                                                                                            
| deleted_at        | None                                 |                                                                                                                            
| hosts             | None                                 |                                                                                                                            
| id                | 2                                    |                                                                                                                            
| is_deleted        | False                                |                                                                                                                            
| name              | fast-io1                             |                                                                                                                            
| properties        | None                                 |                                                                                                                            
| updated_at        | None                                 |                                                                                                                            
| uuid              | 9c8cf8a6-8a36-4ef6-b452-588015fa776a |                                                                                                                            
+-------------------+--------------------------------------+                                                                                                                            
root@hapu-lab-01:~# openstack aggregate add host 1 hapu-lab-02                                                                                                                          
+-------------------+--------------------------------------+                                                                                                                            
| Field             | Value                                |                                                                                                                            
+-------------------+--------------------------------------+                                                                                                                            
| availability_zone | nova                                 |                                                                                                                            
| created_at        | 2026-01-14T03:22:00.000000           |                                                                                                                            
| deleted_at        | None                                 |                                                                                                                            
| hosts             | hapu-lab-02                          |                                                                                                                            
| id                | 1                                    |                                                                                                                            
| is_deleted        | False                                |                                                                                                                            
| name              | fast-io                              |                                                                                                                            
| properties        | availability_zone='nova', ssd='true' |                                                                                                                            
| updated_at        | None                                 |                                                                                                                            
| uuid              | None                                 |                                                                                                                            
+-------------------+--------------------------------------+                                                                                                                            
root@hapu-lab-01:~# openstack flavor create --id 6 --ram 8192 --disk 80 --vcpus 4 ssd.large
+----------------------------+-----------+                                                   
| Field                      | Value     |                                                                                                                                              
+----------------------------+-----------+                                                                                                                                              
| OS-FLV-DISABLED:disabled   | False     |                                                                                                                                              
| OS-FLV-EXT-DATA:ephemeral  | 0         |                                                                                                                                              
| description                | None      |                                                                                                                                              
| disk                       | 80        |                                                                                                                                              
| id                         | 6         |                                                                                                                                              
| name                       | ssd.large |                                                                                                                                              
| os-flavor-access:is_public | True      |                                                                                                                                              
| properties                 |           |                                                                                                                                              
| ram                        | 8192      |                                                                                                                                              
| rxtx_factor                | 1.0       |                                                                                                                                              
| swap                       | 0         |                                                                                                                                              
| vcpus                      | 4         |                                                                                                                                              
+----------------------------+-----------+                                                                                                                                              
root@hapu-lab-01:~# openstack flavor set \                                                                                                                                              
    --property aggregate_instance_extra_specs:ssd=true ssd.large                                    

root@hapu-lab-01:~# openstack flavor show ssd.large                                                                                                        
+----------------------------+-------------------------------------------+                                                                                                              
| Field                      | Value                                     |                                                                                                              
+----------------------------+-------------------------------------------+                                                                                                              
| OS-FLV-DISABLED:disabled   | False                                     |                                                                                                              
| OS-FLV-EXT-DATA:ephemeral  | 0                                         |                                                                                                              
| access_project_ids         | None                                      |                                                                                                              
| description                | None                                      |                                                                                                              
| disk                       | 80                                        |                                                                                                              
| id                         | 6                                         |                                                                                                              
| name                       | ssd.large                                 |                                                                                                              
| os-flavor-access:is_public | True                                      |                                                                                                              
| properties                 | aggregate_instance_extra_specs:ssd='true' |                                                                                                              
| ram                        | 8192                                      |                                                                                                              
| rxtx_factor                | 1.0                                       |                                                                                                              
| swap                       | 0                                         |                                                                                                              
| vcpus                      | 4                                         |                                                                                                              
+----------------------------+-------------------------------------------+                                                                                  
```

Tạo instance với flavor ssd.large
```sh
root@hapu-lab-01:~# openstack server create --flavor ssd.large --image cirros --network selfservice --security-group 3a7af6c7-360c-4774-884b-ba4a34395bc9 testScheduler2
```

Tạo instance với flavor khác
```sh
root@hapu-lab-01:~# openstack server create --flavor type1 --image cirros --network selfservice --security-group 3a7af6c7-360c-4774-884b-ba4a34395bc9 testScheduler3
```

Kiểm tra sẽ thấy testScheduler2 được tạo trên hapu-lab-02 còn testScheduler3được tạo trên hapu-lab-01
```sh
root@hapu-lab-01:~# openstack server list --host hapu-lab-01
+--------------------------------------+----------------+--------+-------------------------------------------------+--------------------------+-----------+
| ID                                   | Name           | Status | Networks                                        | Image                    | Flavor    |
+--------------------------------------+----------------+--------+-------------------------------------------------+--------------------------+-----------+
| 0466ba78-3559-42be-a9c1-d82fd7e88757 | testScheduler3 | ACTIVE | selfservice=192.168.10.46                       | cirros                   | type1     |
+--------------------------------------+----------------+--------+-------------------------------------------------+--------------------------+-----------+

root@hapu-lab-01:~# openstack server list --host hapu-lab-02
+--------------------------------------+----------------+--------+----------------------------+--------+-----------+
| ID                                   | Name           | Status | Networks                   | Image  | Flavor    |
+--------------------------------------+----------------+--------+----------------------------+--------+-----------+
| 878ad16e-ad5b-48fe-88e2-c6a919246c12 | testScheduler2 | ACTIVE | selfservice=192.168.10.142 | cirros | ssd.large |
+--------------------------------------+----------------+--------+----------------------------+--------+-----------+
```














