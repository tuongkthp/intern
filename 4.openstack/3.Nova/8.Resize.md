# Resize
- Resize là quá trình thay đổi flavor của VM, resize có thể thực hiện trên cùng host hoặc resize đến host khác.

- Các đặc điểm cần chú ý:
    + Phải resize VM đến flavor khác.

    + Không thể resize VM nếu VM đó đang ở trạng thái được resized

    + Không thể resize VM đến disk flavor có kích thước nhỏ hơn disk flavor hiện tại của VM.

    + Nếu resize đến cùng host, nhưng host đó không đủ tài nguyên cho flavor mới, VM sẽ không thay đổi flavor.

    + Bạn có thể giảm CPU, nhưng bạn không thể giảm kích thước disk của bất kỳ VM nào

- Resize đến host khác yêu cầu cấu hình SSH giữa 2 host.

- Chú ý: đối với KVM nếu chọn một flavor có disk nhỏ hơn thì KVM sẽ bỏ qua quá trình resize disk nếu không hoàn thành. Các tài nguyên khác được thay đổi kích thước cho phù hợp. Resize instance chỉ hỗ trợ local storage.


# Lab resize
- Tạo một flavor mới
```sh
openstack flavor create --ram 3072 --disk 30 --vcpus 3 type4
```

- Resize vm
```sh
openstack server resize vm122 --flavor type4
```

- Khi phải thấy status của vm122 là VERIFY_RESIZE
```sh
root@hapu-lab-01:~# openstack server show aa82dbef-0bb1-4aca-8b42-9837e0de0458
+-------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------+
| Field                               | Value                                                                                                                                          |
+-------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                   | MANUAL                                                                                                                                         |
| OS-EXT-AZ:availability_zone         | nova                                                                                                                                           |
| OS-EXT-SRV-ATTR:host                | hapu-lab-01                                                                                                                                    |
| OS-EXT-SRV-ATTR:hostname            | vm122                                                                                                                                          |
| OS-EXT-SRV-ATTR:hypervisor_hostname | hapu-lab-01                                                                                                                                    |
| OS-EXT-SRV-ATTR:instance_name       | instance-0000001f                                                                                                                              |
| OS-EXT-SRV-ATTR:kernel_id           |                                                                                                                                                |
| OS-EXT-SRV-ATTR:launch_index        | 0                                                                                                                                              |
| OS-EXT-SRV-ATTR:ramdisk_id          |                                                                                                                                                |
| OS-EXT-SRV-ATTR:reservation_id      | r-qumfzv0x                                                                                                                                     |
| OS-EXT-SRV-ATTR:root_device_name    | /dev/vda                                                                                                                                       |
| OS-EXT-SRV-ATTR:user_data           | None                                                                                                                                           |
| OS-EXT-STS:power_state              | Running                                                                                                                                        |
| OS-EXT-STS:task_state               | None                                                                                                                                           |
| OS-EXT-STS:vm_state                 | resized                                                                                                                                        |
| OS-SRV-USG:launched_at              | 2026-01-07T10:28:18.000000                                                                                                                     |
| OS-SRV-USG:terminated_at            | None                                                                                                                                           |
| accessIPv4                          |                                                                                                                                                |
| accessIPv6                          |                                                                                                                                                |
| addresses                           | selfservice=192.168.10.108                                                                                                                     |
| config_drive                        |                                                                                                                                                |
| created                             | 2026-01-07T10:02:38Z                                                                                                                           |
| description                         | None                                                                                                                                           |
| flavor                              | description=, disk='30', ephemeral='0', , id='type4', is_disabled=, is_public='True', location=, name='type4', original_name='type4',          |
|                                     | ram='3072', rxtx_factor=, swap='0', vcpus='3'                                                                                                  |
| hostId                              | f0068331360d9d8a8e17841db48fe1347669ab63dff99ab9767616c5                                                                                       |
| host_status                         | UP                                                                                                                                             |
| id                                  | aa82dbef-0bb1-4aca-8b42-9837e0de0458                                                                                                           |
| image                               | cirros (75399a16-af4b-4774-b966-c5c1d59e8753)                                                                                                  |
| key_name                            | None                                                                                                                                           |
| locked                              | False                                                                                                                                          |
| locked_reason                       | None                                                                                                                                           |
| name                                | vm122                                                                                                                                          |
| pinned_availability_zone            | nova                                                                                                                                           |
| progress                            | 0                                                                                                                                              |
| project_id                          | 5fa75f581b2940d0ae389d2b0075ba16                                                                                                               |
| properties                          |                                                                                                                                                |
| security_groups                     | name='default'                                                                                                                                 |
| server_groups                       | []                                                                                                                                             |
| status                              | VERIFY_RESIZE                                                                                                                                  |
| tags                                |                                                                                                                                                |
| trusted_image_certificates          | None                                                                                                                                           |
| updated                             | 2026-01-07T10:28:18Z                                                                                                                           |
| user_id                             | 7b9ace3166cb40f3ae53bc024ecd50cf                                                                                                               |
| volumes_attached                    |                                                                                                                                                |
+-------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------+
```

- Xác nhận resize
```sh
openstack server resize confirm vm122
```

Lưu ý: mặc định khi resize sẽ tìm một host khác để resize trên host đó `allow_resize_to_same_host = False`, sửa thành `True` nếu muốn resize trên cùng một host

